# 


А как в юниксе сделать так, чтобы будучи шифрованным на диске он еще будучи подключенным через SSH был бы отключен от клавиатуры и мышки физической и вообще в настройках железки и в настройках ОС он с них данные не принимал, на случай если к устройству физически подключатся


**Warning** Прежде всего уточню: полностью «отключить» физический ввод — это довольно радикальная мера. Если SSH-сессия оборвётся, вы больше не сможете ни с клавиатуры, ни удалённо ввести даже пароль. Учтите риск «отстрелить себе же ноги».

Ниже — схема в три уровня: 1) прошивка (BIOS/UEFI), 2) загрузчик/ядро, 3) ОС (через модули, udev и службы).

---

### 1. На уровне прошивки (BIOS/UEFI)

1. **Установите пароль администратора BIOS** — чтобы никто не смог включить отключённые порты обратно.
2. **Отключите USB‑контроллер или порты** (USB Legacy Support → Disabled).
3. **Отключите PS/2‑контроллер**, если есть такой пункт (или физически заклейте гнёзда).

*Это даст самую надёжную защиту от любого физического HID‐устройства.*

---

### 2. На уровне загрузчика и ядра

1. **Удалите консоль из командной строки ядра.**
   В файле `/etc/default/grub` найдите строку

   ```
   GRUB_CMDLINE_LINUX="…"
   ```

   и убедитесь, что там **нет** `console=tty0` или `console=ttyS0`.
2. **Добавьте параметры отключения PS/2**

   ```diff
   GRUB_CMDLINE_LINUX="… i8042.noaux i8042.nomux"
   ```

   — это гарантированно отключит PS/2‑клавиатуру/мышь на уровне i8042‑драйвера.
3. После правки выполните

   ```bash
   sudo update-grub
   ```

---

### 3. В ОС: модульная и сервисная блокировка

#### a) Блокировка USB‑клавиатур и мышей

Создайте файл `/etc/modprobe.d/disable-input.conf`:

```bash
# отключить USB HID‑устройства
blacklist usbhid
blacklist hid_generic
blacklist hid

# (опционально) если есть другие HID‑драйверы
blacklist atkbd
blacklist psmouse
```

Это запретит загрузку соответствующих модулей при старте.

#### b) Отключить встроенные виртуальные устройства через udev

Создайте `/etc/udev/rules.d/99-disable-input.rules`:

```ini
# для всех устройств input выставлять права 000
SUBSYSTEM=="input", ACTION=="add|change", RUN+="/bin/sh -c 'chmod 000 /dev/input/event*'"
```

Затем:

```bash
sudo udevadm control --reload
sudo udevadm trigger
```

#### c) Отключить getty на локальных консолях

Если вы хотите, чтобы даже `Ctrl+Alt+F1…F6` ничего не давали:

```bash
sudo systemctl mask getty@tty1.service getty@tty2.service \
               getty@tty3.service getty@tty4.service \
               getty@tty5.service getty@tty6.service
```

---

### 4. РемOTE‑разблокировка диска (инициализация SSH в initramfs)

Если вы шифруете диск (`LUKS`), но не хотите смотреть на экран с предложением ввести пароль вручную:

1. **Добавьте Dropbear в initramfs.**

   * В Debian/Ubuntu: установите `dropbear-initramfs`.
   * Настройте в `/etc/dropbear-initramfs/config`: публичный ключ вашего SSH‑ключа, порт и т. д.
2. **Пересоберите initramfs**:

   ```bash
   sudo update-initramfs -u
   ```
3. При загрузке система остановится на этапе «Waiting for encrypted disks…», но вы сразу сможете зайти по SSH в initramfs, ввести пароль LUKS и продолжить загрузку.

---

## Итоговый порядок действий

1. **BIOS**: пароль + отключить USB/PS2
2. **GRUB**: убрать `console=…`, добавить `i8042.noaux i8042.nomux` → `update-grub`
3. **/etc/modprobe.d/disable-input.conf** → блокировка HID‑модулей
4. **/etc/udev/rules.d/99-disable-input.rules** → права 000 на `/dev/input`
5. **Mask getty\@tty*.service*\* → отключить локальные консоли
6. **Dropbear in initramfs** → удалённая разблокировка LUKS

После этого, даже если к машине физически подключат клавиатуру или мышь, ядро и ОС не загрузят драйверы, а консоли будут заглушены — единственный путь управления останется по SSH.
